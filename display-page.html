<html>
	<title>Javabot</title>
	
	<body></body>
	
	<script>
		const width = window.innerWidth, height = window.innerHeight;
		const viewWidth = Math.min(width, height)
		
		const numRows = 10, numCols = 10
		const rowHeight = viewWidth / numRows, colWidth = viewWidth / numCols
		
		const canvas = document.createElement("canvas")
		canvas.setAttribute("position", "fixed")
		canvas.setAttribute("left", "0px")
		canvas.setAttribute("top", "0px")
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		document.body.setAttribute("style", "margin: 0px; padding: 0px;")
		document.body.appendChild(canvas)
		
		let gameState = {}
		
		function clearBackground () {
			ctx.fillStyle = "white"
			ctx.fillRect(0, 0, width, height)
		}
		
		function drawLine (x1, y1, x2, y2, w) {
			ctx.lineWidth = w
			ctx.strokeStyle = "black"
			ctx.beginPath()
			ctx.moveTo(x1, y1)
			ctx.lineTo(x2, y2)
			ctx.stroke()
		}
		
		function drawRect (x, y, w, h, c) {
			ctx.fillStyle = c
			ctx.fillRect(x, y, w, h)
		}
		
		function drawBackground () {
			clearBackground()
			for (let row = 0; row <= numRows; row ++)
				drawLine(0, row*rowHeight, viewWidth, row*rowHeight, 3)
			for (let col = 0; col <= numCols; col ++)
				drawLine(col*colWidth, 0, col*colWidth, viewWidth, 3)
		}
		
		function drawRobot () {
			ctx.translate(colWidth * (gameState.x + 0.5), rowHeight * (gameState.y + 0.5))
			ctx.rotate((-Math.PI/2) * gameState.rotation)
			drawRect(
				-colWidth * 0.4,
				-rowHeight * 0.4,
				colWidth * 0.8,
				rowHeight * 0.8,
				"black")
			drawRect(
				colWidth * 0.25,
				-rowHeight * 0.2,
				colWidth * 0.1,
				rowHeight * 0.4,
				"white")
			ctx.rotate((Math.PI/2) * gameState.rotation)
			ctx.translate(-colWidth * (gameState.x + 0.5), -rowHeight * (gameState.y + 0.5))
		}
		
		function updateView (response) {
			drawBackground()
			drawRobot()
		}
		
		const ctx = canvas.getContext("2d")
		
		const paused = false
		
		setInterval(function(){
			let req = new XMLHttpRequest()
			req.open("POST", "http://localhost:4445", true)
			req.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
			req.onreadystatechange = function () {
				if (this.readyState == 4) {
					gameState = JSON.parse(this.responseText)
					updateView()
				}
			}
			req.send(`ROBOT DATA UPDATE\nPAUSED:${paused}\n`)
		}, 100);
	</script>
	
</html>